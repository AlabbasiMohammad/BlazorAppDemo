@page "/product-form"
@page "/product-form/{Id:int}"
@using BlazorAppDemo.Components.Models
@using BlazorAppDemo.Components.Services

@inject ProductService ProductService
@inject NavigationManager NavigationManager

<h3>@(Id == 0 ? "Add Product" : "Edit Product")</h3>

<div class="mt-3">
    <label>Name</label>
    <input class="form-control" @bind="product.Name" />

    <label class="mt-2">Price</label>
    <input class="form-control" type="number" step="0.01" @bind="product.Price" />
</div>

<button class="btn btn-success mt-3" @onclick="Save">Save</button>
<button class="btn btn-secondary mt-3" @onclick="Cancel">Cancel</button>

@code {
    [Parameter] public int Id { get; set; }
    Product product = new();

    protected override void OnInitialized()
    {
        if (Id != 0)
        {
            var existing = ProductService.GetById(Id);
            if (existing != null)
                product = new Product
                {
                    Id = existing.Id,
                    Name = existing.Name,
                    Price = existing.Price
                };
        }
    }

    void Save()
    {
        if (Id == 0)
            ProductService.Add(product);
        else
            ProductService.Update(product);

        NavigationManager.NavigateTo("/products");
    }

    void Cancel() =>
        NavigationManager.NavigateTo("/products");
}
